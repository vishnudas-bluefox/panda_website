<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="PandaDownloader.css">
</head>
<body>
    <div class="container">
        <div id="logo">
            <img src="Images/PandaDownloaderLogo.svg" alt="PandaDownloaderLogo" width="600px">
        </div>
        <div class="navbar">
            <div class="nav">
                <button class="youtube active button">
                    <img src="Images/YoutubeIcon.svg" alt="YoutubeIcon" width="60px">
                </button>
                <button class="instagram button">
                    <img src="Images/InstagramIcon.svg" alt="InstagramIcon" width="60px">
                </button>
                <button class="facebook button">
                    <img src="Images/FacebookIcon.svg" alt="FacebookIcon" width="60px">
                </button>
                <button class="twitter button">
                    <img src="Images/TwitterIcon.svg" alt="TwitterIcon" width="60px">
                </button>
            </div>
        </div>
        <div class="search">
            <input type="text" placeholder="Enter the Url Here to Find" id="urlholder" name="search">
            <button class="button searchicon" type="submit" onclick="test()"><img src="Images/SearchIcon.svg" alt="" width="60px"></button>
        </div>
        <div id="downloads">
        </div>
        <div id="download">
        </div>
        <div class="footer">
            <img id="poweredby" src="Images/PoweredByBluefox.svg" alt="InstagramIcon">
        </div>
    </div>
    <script>
     function test() {
         var url = "http://localhost:8000/youtube/test/";
         var params = "url=https://www.youtube.com/watch?v=Soa3gO7tL-c&list=RDGMEM6ijAnFTG9nX1G-kbWBUCJAVMSoa3gO7tL-c&start_radio=1";
         var http = new XMLHttpRequest();
         let output= "";
         http.open("GET", url+"?"+params, true);
         http.onreadystatechange = function()
         {
             if(http.readyState == 4 && http.status == 200) {
                 data=JSON.parse(http.response);
                 output += `
                 <div class="downloads">
                 <input type="hidden" id="videourl" value=${data.Video_url}>
                 <img class="thumbnail" src=${data.tumbnail_url}>
                   <h2>${data.title}</h2>
                 <div class="quality">
                    <select id="mySelect">`
                 for(i in data.resolutions){
                      output+=`
                    <option value="${data.resolutions[i]}">${data.resolutions[i]}</option>
                      `
                 }
                 output +=`
                    </select>
                    </div>
            <button class="download button" onclick="download()">
                <img src="Images/Download.svg" alt="InstagramIcon" width="60px">
            </button>

                 `;
                 console.log(data);
             }
             document.getElementById("downloads").innerHTML = output;
         }
         http.send(null);

     }

     function download(){
         console.log("intialized");
         var selected_resolution = document.getElementById("mySelect").value;
         var video_url = document.getElementById("videourl").value
         params="url="+video_url+"&resolution="+selected_resolution
         endpoint = "http://localhost:8000/youtube/download/"
         var http = new XMLHttpRequest();
         http.open("GET",endpoint+"?"+params,true);
         console.log("request sended");
         output=""
         http.onreadystatechange = function()
         {
             console.log("status: "+http.status);
             data2 = JSON.parse(http.response);
             console.log(data2);

             output+=`
                <a href="${data2.location}" download>
             `

             if(http.readyState ==4 && http.statue ==200) {
                 data = JSON.parse(http.response);
                 console.log(data);
             }
         }
         document.getElementById("download").innerHTML = output;
         http.send(null);
     }


    </script>
</body>
</html>
